---
module: dcnm_service_policy
short_description: DCNM ansible module for managing service policies.
version_added: "1.2.0"
description:
    - DCNM ansible module for creating, deleting, querying and modifying service policies
author: Mallik Mudigonda (@mmudigon)
options:
  fabric:
    description:
      - 'name of the target fabric for service policy operations'
    type: str
    required: true
  service_fabric:
    description:
      - 'name of the external fabric attached to the service node for service policy operations'
    type: str
    required: true
  state:
    description:
      - the required state of the configuration after module completion.
    type: str
    required: false
    choices:
      - merged
      - replaced
      - overridden
      - deleted
      - query
    default: merged
  attach:
    description:
      - a flag specifying if the given service policy is to be attached to the specified service node
    type: bool
    required: false
    default: true
  deploy:
    description:
      - a flag specifying if a service policy is to be deployed on the switches
    type: bool
    required: false
    default: true
  config:
    description:
      - a list of dictionaries containing service policy and switch information
    type: list
    elements: dict
    suboptions:
      name:
        description:
          - a unique name which identifies the service policy
        type: str
        required: true
      src_vrf:
        description:
          - name of the source vrf for this service policy
        type: str
        required: true
      dest_vrf:
        description:
          - name of the destination vrf for this service policy
        type: str
        required: true
      src_network:
        description:
          - name of the source network for this service policy
        type: str
        required: true
      dest_network:
        description:
          - name of the destination network for this service policy
        type: str
        required: true
      next_hop:
        description:
          - next hop ip address to be used in source to network direction
          - This must exactly match the next hop IP configured for the route
            peering associated with this policy
        type: str
        required: false
        default: ''
      reverse_next_hop:
        description:
          - reverse next hop ip address to be used in network to source direction
          - This must exactly match the reverse next hop IP configured for the route
            peering associated with this policy
        type: str
        required: false
        default: ''
      policy:
        description:
          - details of the policy (ACL) to be applied
        type: dict
        suboptions:
          proto:
            description:
              - protocol to be matched to apply this ACL
            type: str
            required: true
            choices:
              - ip
              - icmp
              - tcp
              - udp
          src_port:
            description:
              - source port number to be matched to apply this ACL
            type: str
            required: true
            choices:  [any, Min 1, Max 65535]
          dest_port:
            description:
              - destination port number to be matched to apply this ACL
            type: str
            required: true
            choices:  [any, Min 1, Max 65535]
          action:
            description:
              - action to apply for traffic matching the service profile
            type: str
            required: false
            choices:  [permit, deny]
            default: permit
          next_hop_option:
            description:
              - option to specify how to redirect traffic
            type: str
            required: false
            choices:  [none, drop-on-fail, drop]
            default: none
          acl_name:
            description:
              - Name of the ACL in the forward direction
            type: str
            required: false
            default: will be auto-generated by DCNM
          rev_acl_name:
            description:
              - Name of the ACL in the reverse direction
            type: str
            required: false
            default: will be auto-generated by DCNM
          route_map_num:
            description:
              - route map match number
              - Minimum Value (1), Maximum Value (65535)
              - Default value is auto-generated by DCNM
            type: int
            required: false
          rev_route_map_num:
            description:
              - route map match number for reverse direction
              - Minimum Value (1), Maximum Value (65535)
              - Default value is auto-generated by DCNM
            type: int
            required: false
